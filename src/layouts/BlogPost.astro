---
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import FormattedDate from "../components/FormattedDate.astro";
import ShowWhen from "@components/ShowWhen.astro";
import { Image } from "astro:assets";
import "../styles/global.css";

type Props = Omit<CollectionEntry<"blog">["data"], "pubDate"> & {
  pubDate?: Date;
  lang: string;
};

const { title, description, pubDate, updatedDate, tags, categories, lang } =
  Astro.props;
---

<html lang={lang}>
  <head>
    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-WJFZWBGZ");
    </script>
    <!-- End Google Tag Manager -->
    <BaseHead title={title} description={description} />
  </head>

  <body class="bg-background text-foreground min-h-screen">
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-WJFZWBGZ"
        height="0"
        width="0"
        style="display:none;visibility:hidden"></iframe></noscript
    >
    <!-- End Google Tag Manager (noscript) -->
    <Header lang={lang} />
    <main class="max-w-[1200px] mx-auto py-8 w-[calc(100%-2em)]">
      <article class="pb-8">
        <div class="prose w-[1200] max-w-[calc(100%-2em)] mx-auto p-4">
          <ShowWhen when={pubDate}>
            <div class="mb-6 py-4 text-center leading-none">
              <h1
                class="font-serif text-4xl font-bold text-foreground mb-6"
                data-testid="post-title"
              >
                {title}
              </h1>
              <hr />
              <div class="flex items-center justify-between my-2">
                <div>
                  <FormattedDate date={pubDate!} lang={lang} />
                  <ShowWhen when={updatedDate}>
                    <div class="italic text-xs">
                      Last updated on <FormattedDate
                        date={updatedDate!}
                        lang={lang}
                      />
                    </div>
                  </ShowWhen>
                </div>
                <div class="flex flex-wrap gap-2 justify-end">
                  {
                    (tags ?? []).map((tag) => (
                      <span class="bg-muted px-2 py-1 rounded-full">{tag}</span>
                    ))
                  }
                </div>
              </div>
            </div>
          </ShowWhen>
          <div class="prose max-w-none">
            <slot />
          </div>
        </div>
      </article>
    </main>
  </body>
</html>
