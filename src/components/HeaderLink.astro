---
import type { HTMLAttributes } from "astro/types";

type Props = HTMLAttributes<"a">;

const { href, class: className, ...props } = Astro.props;
const pathname = Astro.url.pathname.replace(import.meta.env.BASE_URL, "");
const subpath = pathname.match(/[^\/]+/g);
const isActive = href === pathname || href === "/" + (subpath?.[0] || "");

// SVGs Lucide exactos
const icons: Record<string, string> = {
  "/": `<svg xmlns='http://www.w3.org/2000/svg' class='h-4 w-4 mr-2 text-muted-foreground' fill='none' viewBox='0 0 24 24' stroke='currentColor' stroke-width='2'><path d='M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8'/><path d='M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z'/></svg>`,
  "/blog": `<svg xmlns='http://www.w3.org/2000/svg' class='h-4 w-4 mr-2 text-muted-foreground' fill='none' viewBox='0 0 24 24' stroke='currentColor' stroke-width='2'><path d='M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z'/><path d='M14 2v4a2 2 0 0 0 2 2h4'/><path d='M10 9H8'/><path d='M16 13H8'/><path d='M16 17H8'/></svg>`,
  "/about": `<svg xmlns='http://www.w3.org/2000/svg' class='h-4 w-4 mr-2 text-muted-foreground' fill='none' viewBox='0 0 24 24' stroke='currentColor' stroke-width='2'><circle cx='12' cy='12' r='10'/><path d='M12 16v-4'/><path d='M12 8h.01'/></svg>`,
  "/categories": `<svg xmlns='http://www.w3.org/2000/svg' class='h-4 w-4 mr-2 text-muted-foreground' fill='none' viewBox='0 0 24 24' stroke='currentColor' stroke-width='2'><path d='m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19'/><path d='M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z'/><circle cx='6.5' cy='9.5' r='.5' fill='currentColor'/></svg>`,
  "/tags": `<svg xmlns='http://www.w3.org/2000/svg' class='h-4 w-4 mr-2 text-muted-foreground' fill='none' viewBox='0 0 24 24' stroke='currentColor' stroke-width='2'><line x1='4' x2='20' y1='9' y2='9'/><line x1='4' x2='20' y1='15' y2='15'/><line x1='10' x2='8' y1='3' y2='21'/><line x1='16' x2='14' y1='3' y2='21'/></svg>`,
};

// Normalizo href a string simple (sin query/hash)
const hrefKey =
  typeof href === "string" ? href.split("?")[0].split("#")[0] : "";
const icon = icons[hrefKey] || "";
---

<a
  href={href}
  class:list={[
    className,
    "inline-flex items-center no-underline",
    { "font-bold underline": isActive },
  ]}
  {...props}
>
  <span class="flex items-center" set:html={icon} /><slot />
</a>
